@page "/create"
@using QLS.Application.Interfaces
@using QLS.Domain.Entities
@using QLS.Domain.Enums
@inject IBookRepository BookRepository
@inject NavigationManager NavigationManager

<PageTitle>
  Thêm Sách
</PageTitle>

@* Enhance="true" nghĩa là không load lại trang *@

<div class="row justify-content-center">
  <div class="col-6">
    <EditForm Enhance="true"
              method="post"
              FormName="AddBookForm"
              OnValidSubmit="AddBook"
              Model="Book"
              autocomplete="off">
      <h3>
        Thêm Sách
      </h3>

      <div class="mb-3">
        <label for="title" class="form-label">
          Tiêu đề cuốn sách
        </label>
        <InputText id="title"
                   @bind-Value="Book.Title"
                   class="form-control shadow-none">
        </InputText>
      </div>

      <div class="mb-3">
        <label for="author" class="form-label">
          Tác giả
        </label>
        <InputText id="author"
                   @bind-Value="Book.Author"
                   class="form-control shadow-none">
        </InputText>
      </div>

      <div class="mb-3">
        <label for="publish-date" class="form-label">
          Ngày xuất bản
        </label>
        <InputDate id="publish-date"
                   @bind-Value="Book.PublishDate"
                   class="form-control shadow-none">
        </InputDate>
      </div>

      @* category *@
      <div class="mb-3">
        <label for="category" class="form-label">
          Danh mục sách
        </label>
        <InputSelect id="category"
                     @bind-Value="Book.Category"
                     class="form-control shadow-none">
          @foreach (var category in Enum.GetValues(typeof(Category)))
          {
            <option value="@category">
              @category.ToString()
            </option>
          }
        </InputSelect>

      </div>
      <div class="mb-3">
        <button class="btn btn-primary">
          Thêm
        </button>
        <a href="/read" class="btn btn-success" data-enhance="false">
          Danh sách các cuốn sách
        </a>
        @* tạo thông báo *@
        <DataAnnotationsValidator></DataAnnotationsValidator>
        <ValidationSummary></ValidationSummary>
      </div>

    </EditForm>

  </div>
</div>

@code {
  [SupplyParameterFromForm]
  public Book Book { get; set; } = new Book();

  private async Task AddBook()
  {
    // Book.Author = Book.Author?.Trim();
    // Book.Author = Book.Author?.Trim();
    await BookRepository.AddAsync(Book);

    // trở lại trang home
    NavigationManager.NavigateTo("/");
  }

}
